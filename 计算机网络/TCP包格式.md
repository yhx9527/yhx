# TCP报文

[![wKioL1mqrc2Al2-aAADUkQ35rYM172.jpg](https://s2.51cto.com/wyfs02/M01/A4/6B/wKioL1mqrc2Al2-aAADUkQ35rYM172.jpg)](https://s2.51cto.com/wyfs02/M01/A4/6B/wKioL1mqrc2Al2-aAADUkQ35rYM172.jpg)

TCP报文由首部和数据两部分组成。首部一般由20-60字节（Byte）构成，长度可变。其中前20B格式固定，后40B为可选。

因为，TCP报文还得传给下层网络层，封装成IP包，而一个IP包最大长度为65535，同时IP包首部也包含最少20B，所以一个IP包或TCP包可以包含的数据部分最大长度为65535-20-20=65495B。

TCP报文中数据部分是可选的，即TCP报文可以不包含数据（同理IP包也可以不包含数据）。不含数据的TCP报文通常是一些确认和控制信息类的报文，如TCP建立连接时的三次握手和TCP终止时的四次挥手等。

1、源端口号（Source Port）

长度为16位，指明发送数据的进程。

2、目的端口号（Destination Port）

长度为16位，指明目的主机接收数据的进程。

3、序号（Sequence Number）

也称为序列号，长度为32位，序号用来标识从TCP发送端向接入端发送的数据字节流进行编号，可以理解成对字节流的计数。

4、确认号（Acknowledgement Number）

长度为32位，确认号包含发送确认的一端所期望收到的下一个序号。确认号只有在ACK标志为1时才有效。

5、首部长度

长度为4位，用于表示TCP报文首部的长度。用4位（bit）表示，十进制值就是[0,15]，一个TCP报文前20个字节是必有的，后40个字节根据情况可能有可能没有。如果TCP报文首部是20个字节，则该位应是20/4=5。

6、保留位（Reserved）

长度为6位，必须是0，它是为将来定义新用途保留的。

7、标志（Code Bits）

长度为6位，在TCP报文中不管是握手还是挥手还是传数据等，这6位标志都很重要。6位从左到右依次为：

1. 

- URG：紧急标志位，说明紧急指针有效；
- ACK：确认标志位，多数情况下空，说明确认序号有效；
- PSH：推标志位，置位时表示接收方应立即请求将报文交给应用层；
- RST：复位标志，用于重建一个已经混乱的连接；
- SYN：同步标志，该标志仅在三次握手建立TCP连接时有效
- FIN：结束标志，带该标志位的数据包用于结束一个TCP会话。

8、窗口大小（Window Size）

长度为16位，TCP流量控制由连接的每一端通过声明的窗口大小来提供。

9、检验和（Checksum）

长度为16位，该字段覆盖整个TCP报文端，是个强制性的字段，是由发送端计算和存储，到接收端后，由接收端进行验证。

10、紧急指针（Urgent Pointer）

长度为16位，指向数据中优先部分的最后一个字节，通知接收方紧急数据的长度，该字段在URG标志置位时有效。

11、选项（Options）

长度为0-40B（字节），必须以4B为单位变化，必要时可以填充0。通常包含：最长报文大小（MaximumSegment Size，MSS）、窗口扩大选项、时间戳选项、选择性确认（Selective ACKnowlegement，SACK）等。

12、数据



### 参考链接

[IP包、TCP报文、UDP数据段格式的汇总](http://blog.51cto.com/mmanong/1962353)

