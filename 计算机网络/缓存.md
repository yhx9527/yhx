# http强缓存和协商缓存

浏览器加载资源的步骤：(未命中则才进入下一阶段)  
强缓存-->协商缓存-->直接从服务器端加载  

强缓存通常用于加载静态资源，第一次从服务器加载之后，根据响应的header中配置的Expires或Cache-Control来设置资源过期时间，其中Expires是服务器的绝对时间，所以当本地的时间和服务器时间差异较大时，就会出现问题。Cache-Control是相对时间，记录有效时长。当浏览器再次请求资源的时候，就会先判断是否命中强缓存，命中的话就直接返回缓存的内容，不请求服务器，其中返回的header是上次缓存的。  

**Cache-Control优先级大于Expires**

当浏览器发现没命中强缓存时，这时就会发一个请求给服务器进行协商缓存。  
协商缓存的可以利用header中的两对字段进行管理  

- [Last-Modified，If-Modified-Since],第一次请求响应中会返回资源的最后修改日期，当浏览器进行协商缓存时就会在请求字段加上If-Modified-Since，该值就是上次服务器返回的Last-Modified时间，服务收到后判断资源的最后修改日期，如果不变就返回304 Not Modified，浏览器就继续使用缓存的资源。用这个字段进行管理有时候会出现一个问题就是服务器的资源改了，但最后修改日期没变化，这个时候浏览器就不能及时后去到最新资源，所以也就有了下面一对。
- [ETag, If-None-Match]，其中ETag是根据资源生成的唯一标识，只要资源有变化，ETag就会发生改变，同刚才上面的步骤一样进行协商请求，其中不同的是当响应是304时，ETag由于重新生成过，所以也会返回，而Last-Modified不会返回。

当协商缓存也没命中，这个时候才会向服务器请求新资源。

注意：强缓存和协商缓存要配合开启，否则自由协商缓存没有意义，因为本地根本就没有缓存